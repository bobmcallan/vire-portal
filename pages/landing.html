<!DOCTYPE html>
<html lang="en">

<head>
    {{template "head.html" .}}
    <title>VIRE</title>
</head>

<body>

    {{if .LoggedIn}}{{template "nav.html" .}}{{end}}

    <main class="landing" x-data="serverCheck()" x-init="check()">
        <div class="landing-inner">

            <div class="landing-hero">
                <h1 class="landing-title">VIRE</h1>
                <p class="landing-tagline" x-show="status !== 'down'">
                    Connect your stock portfolio to Claude via MCP.
                </p>
                <p class="landing-tagline" x-show="status === 'down'" x-cloak>
                    The authentication server is unavailable.
                </p>
            </div>

            <template x-if="status === 'down'">
                <div class="landing-actions">
                    <button class="btn btn-primary" @click="check()">RETRY</button>
                </div>
            </template>

            <template x-if="status !== 'down'">
                <div class="landing-actions">
                    <a href="/api/auth/login/google" class="btn btn-primary">
                        SIGN IN WITH GOOGLE
                    </a>
                    <a href="/api/auth/login/github" class="btn btn-secondary">
                        SIGN IN WITH GITHUB
                    </a>
                    <div class="landing-divider">
                        <span>or</span>
                    </div>
                    <form method="POST" action="/api/auth/login" class="landing-login-form">
                        <input type="text" name="username" placeholder="Username" value="{{if .DevMode}}dev_user{{end}}" required>
                        <input type="password" name="password" placeholder="Password" value="{{if .DevMode}}dev123{{end}}" required>
                        <button type="submit" class="btn btn-login">SIGN IN</button>
                    </form>
                </div>
            </template>

            <div class="landing-features" x-show="status !== 'down'">
                <div class="feature-card">
                    <div class="feature-label">[01] API KEYS</div>
                    <p>Bring your own EODHD, Navexa, and Gemini API keys. Your data, your keys.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-label">[02] MCP PROXY</div>
                    <p>One-click provisioning of your dedicated MCP endpoint on Cloud Run.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-label">[03] CONNECT</div>
                    <p>Copy your config into Claude Code or Claude Desktop and start querying.</p>
                </div>
            </div>

            <div class="landing-contact" x-show="status !== 'down'">
                <span class="landing-contact-label">CONTACT</span>
                <a href="mailto:bobmcallan@gmail.com">bobmcallan@gmail.com</a>
            </div>

        </div>
    </main>

    {{template "footer.html" .}}

    <script>
    function serverCheck() {
        return {
            status: 'checking',
            check() {
                this.status = 'checking';
                fetch('/api/server-health')
                    .then(r => r.json())
                    .then(d => { this.status = d.status === 'ok' ? 'ok' : 'down'; })
                    .catch(() => { this.status = 'down'; });
            }
        };
    }
    </script>

</body>

</html>
